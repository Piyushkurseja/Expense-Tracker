<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ExpenseTrack | Manage Your Spending</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style id="app-style">
    body {
      font-family: 'Inter', sans-serif;
      transition: background-color 0.3s, color 0.3s;
    }
    .dark {
      background-color: #1a1a1a;
      color: #f5f5f5;
    }
    .dark .card {
      background-color: #2d2d2d;
      border-color: #444;
    }
    .dark .nav-tab {
      color: #aaa;
    }
    .dark .nav-tab.active {
      color: #fff;
      border-bottom-color: #3b82f6;
    }
    .dark input, .dark select, .dark textarea {
      background-color: #333;
      border-color: #555;
      color: #eee;
    }
    .dark .btn-primary {
      background-color: #3b82f6;
    }
    .dark .table-row:hover {
      background-color: #333;
    }
    .toast {
      position: fixed;
      bottom: 1rem;
      right: 1rem;
      padding: 0.75rem 1.5rem;
      background-color: #10B981;
      color: white;
      border-radius: 0.375rem;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      transform: translateY(100px);
      opacity: 0;
      transition: transform 0.3s, opacity 0.3s;
      z-index: 50;
    }
    .toast.show {
      transform: translateY(0);
      opacity: 1;
    }
    .expense-table th {
      cursor: pointer;
    }
    .expense-table th:hover {
      background-color: rgba(0, 0, 0, 0.05);
    }
    .dark .expense-table th:hover {
      background-color: rgba(255, 255, 255, 0.05);
    }
    .loading {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }
    .empty-state {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 2rem;
      text-align: center;
    }
    .tab-content {
      display: none;
    }
    .tab-content.active {
      display: block;
    }
    .card {
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .card:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    }
  </style>
</head>
<body class="bg-gray-50">
  <div id="app" class="min-h-screen flex flex-col">
    <!-- Header -->
    <header class="bg-white dark:bg-gray-800 shadow-sm">
      <div class="container mx-auto px-4 py-4 flex justify-between items-center">
        <h1 class="text-2xl font-bold text-gray-800 dark:text-white flex items-center">
          <i class="fas fa-wallet mr-2 text-blue-500"></i>
          ExpenseTrack
        </h1>
        <button id="darkModeToggle" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">
          <i class="fas fa-moon dark:hidden text-gray-600"></i>
          <i class="fas fa-sun hidden dark:block text-yellow-300"></i>
        </button>
      </div>
    </header>

    <!-- Navigation -->
    <nav class="bg-white dark:bg-gray-800 shadow-sm">
      <div class="container mx-auto px-4">
        <div class="flex space-x-4 overflow-x-auto">
          <button class="nav-tab py-4 px-2 border-b-2 border-blue-500 font-medium text-sm text-blue-500 active" data-tab="home">
            <i class="fas fa-home mr-1"></i> Home
          </button>
          <button class="nav-tab py-4 px-2 border-b-2 border-transparent font-medium text-sm text-gray-500" data-tab="add-expense">
            <i class="fas fa-plus mr-1"></i> Add Expense
          </button>
          <button class="nav-tab py-4 px-2 border-b-2 border-transparent font-medium text-sm text-gray-500" data-tab="reports">
            <i class="fas fa-chart-pie mr-1"></i> Reports
          </button>
        </div>
      </div>
    </nav>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-6 flex-grow">
      <!-- Home Tab -->
      <div id="home" class="tab-content active">
        <div class="mb-6 flex flex-wrap items-center justify-between">
          <h2 class="text-xl font-semibold text-gray-800 dark:text-white mb-4 md:mb-0">Spending Overview</h2>
          <div class="flex flex-wrap gap-3">
            <select id="categoryFilter" class="bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md py-2 px-3 text-sm">
              <option value="">All Categories</option>
              <option value="Food">Food</option>
              <option value="Travel">Travel</option>
              <option value="Utilities">Utilities</option>
              <option value="Entertainment">Entertainment</option>
              <option value="Health">Health</option>
              <option value="Others">Others</option>
            </select>
            <div class="flex items-center space-x-2">
              <input type="date" id="startDate" class="bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md py-2 px-3 text-sm">
              <span class="text-gray-500">to</span>
              <input type="date" id="endDate" class="bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md py-2 px-3 text-sm">
            </div>
          </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
          <!-- Weekly Summary Card -->
          <div class="card bg-white dark:bg-gray-800 rounded-xl shadow-md p-6">
            <h3 class="text-sm font-medium text-gray-500 dark:text-gray-400 mb-1">Weekly Spending</h3>
            <div class="flex items-end justify-between">
              <div>
                <div id="weeklyTotal" class="text-3xl font-bold text-gray-900 dark:text-white">$0.00</div>
                <p id="weeklyDates" class="text-xs text-gray-500 dark:text-gray-400 mt-1">Apr 10 - Apr 16</p>
              </div>
              <div id="weeklyTrend" class="h-16 w-24">
                <canvas id="weeklyTrendChart"></canvas>
              </div>
            </div>
          </div>

          <!-- Monthly Summary Card -->
          <div class="card bg-white dark:bg-gray-800 rounded-xl shadow-md p-6">
            <h3 class="text-sm font-medium text-gray-500 dark:text-gray-400 mb-1">Monthly Spending</h3>
            <div class="flex items-end justify-between">
              <div>
                <div id="monthlyTotal" class="text-3xl font-bold text-gray-900 dark:text-white">$0.00</div>
                <p id="monthlyDates" class="text-xs text-gray-500 dark:text-gray-400 mt-1">April 2025</p>
              </div>
              <div id="monthlyTrend" class="h-16 w-24">
                <canvas id="monthlyTrendChart"></canvas>
              </div>
            </div>
          </div>
        </div>

        <!-- Recent Transactions -->
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md p-6">
          <h3 class="text-lg font-medium text-gray-800 dark:text-white mb-4">Recent Transactions</h3>
          <div id="recentTransactions" class="overflow-x-auto">
            <!-- Transactions will be loaded here -->
            <div class="empty-state py-8">
              <i class="fas fa-receipt text-4xl text-gray-300 dark:text-gray-600 mb-2"></i>
              <p class="text-gray-500 dark:text-gray-400">No recent transactions to display</p>
              <button class="nav-link mt-3 px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition-colors" data-tab="add-expense">
                Add your first expense
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Add Expense Tab -->
      <div id="add-expense" class="tab-content">
        <div class="max-w-2xl mx-auto">
          <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md p-6">
            <h2 class="text-xl font-semibold text-gray-800 dark:text-white mb-6">Add New Expense</h2>
            
            <form id="expenseForm" class="space-y-6">
              <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                  <label for="expenseDate" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Date</label>
                  <input type="date" id="expenseDate" name="date" required
                    class="w-full rounded-md border border-gray-300 dark:border-gray-600 py-2 px-3">
                </div>
                <div>
                  <label for="expenseAmount" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Amount</label>
                  <div class="relative">
                    <span class="absolute left-3 top-2 text-gray-500">$</span>
                    <input type="number" id="expenseAmount" name="amount" step="0.01" min="0.01" required
                      class="w-full rounded-md border border-gray-300 dark:border-gray-600 py-2 pl-8 pr-3">
                  </div>
                </div>
              </div>

              <div>
                <label for="expenseCategory" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Category</label>
                <div class="flex">
                  <select id="expenseCategory" name="category" required
                    class="w-full rounded-l-md border border-gray-300 dark:border-gray-600 py-2 px-3">
                    <option value="">Select Category</option>
                    <option value="Food">Food</option>
                    <option value="Travel">Travel</option>
                    <option value="Utilities">Utilities</option>
                    <option value="Entertainment">Entertainment</option>
                    <option value="Health">Health</option>
                    <option value="Others">Others</option>
                  </select>
                  <button type="button" id="addCategoryBtn" 
                    class="bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 px-3 rounded-r-md border-y border-r border-gray-300 dark:border-gray-600 hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors">
                    <i class="fas fa-plus"></i>
                  </button>
                </div>
                <div id="customCategoryInput" class="mt-2 hidden">
                  <div class="flex">
                    <input type="text" id="newCategory" placeholder="New category name"
                      class="w-full rounded-l-md border border-gray-300 dark:border-gray-600 py-2 px-3">
                    <button type="button" id="saveCategoryBtn" 
                      class="bg-blue-500 text-white px-3 rounded-r-md hover:bg-blue-600 transition-colors">
                      <i class="fas fa-check"></i>
                    </button>
                  </div>
                </div>
              </div>

              <div>
                <label for="expenseDescription" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Description (Optional)</label>
                <textarea id="expenseDescription" name="description" rows="3"
                  class="w-full rounded-md border border-gray-300 dark:border-gray-600 py-2 px-3"></textarea>
              </div>

              <div class="pt-2">
                <button type="submit" class="w-full bg-blue-500 text-white py-2 px-4 rounded-md hover:bg-blue-600 transition-colors">
                  Save Expense
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>

      <!-- Reports Tab -->
      <div id="reports" class="tab-content">
        <!-- Filter Controls -->
        <div class="mb-6 flex flex-wrap gap-3 items-center justify-between">
          <h2 class="text-xl font-semibold text-gray-800 dark:text-white">Detailed Reports</h2>
          <div class="flex flex-wrap gap-3">
            <select id="reportCategoryFilter" class="bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md py-2 px-3 text-sm">
              <option value="">All Categories</option>
              <option value="Food">Food</option>
              <option value="Travel">Travel</option>
              <option value="Utilities">Utilities</option>
              <option value="Entertainment">Entertainment</option>
              <option value="Health">Health</option>
              <option value="Others">Others</option>
            </select>
            <div class="flex items-center space-x-2">
              <input type="date" id="reportStartDate" class="bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md py-2 px-3 text-sm">
              <span class="text-gray-500">to</span>
              <input type="date" id="reportEndDate" class="bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md py-2 px-3 text-sm">
            </div>
            <button id="exportCSV" class="bg-green-500 text-white py-2 px-4 rounded-md hover:bg-green-600 transition-colors">
              <i class="fas fa-download mr-1"></i> Export CSV
            </button>
          </div>
        </div>

        <!-- Charts -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
          <!-- Category Pie Chart -->
          <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md p-6">
            <h3 class="text-lg font-medium text-gray-800 dark:text-white mb-4">Spending by Category</h3>
            <div class="h-64">
              <canvas id="categoryPieChart"></canvas>
            </div>
          </div>

          <!-- Time Series Chart -->
          <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md p-6">
            <h3 class="text-lg font-medium text-gray-800 dark:text-white mb-4">Spending Over Time</h3>
            <div class="flex justify-end mb-2">
              <div class="inline-flex rounded-md shadow-sm" role="group">
                <button id="viewWeekly" class="bg-blue-500 text-white px-3 py-1 text-sm rounded-l-md hover:bg-blue-600">Weekly</button>
                <button id="viewMonthly" class="bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 px-3 py-1 text-sm rounded-r-md hover:bg-gray-300 dark:hover:bg-gray-600">Monthly</button>
              </div>
            </div>
            <div class="h-64">
              <canvas id="timeSeriesChart"></canvas>
            </div>
          </div>
        </div>

        <!-- Expense Table -->
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md p-6">
          <div class="flex flex-wrap justify-between items-center mb-4">
            <h3 class="text-lg font-medium text-gray-800 dark:text-white">All Expenses</h3>
            <div class="mt-2 sm:mt-0">
              <input type="text" id="searchExpenses" placeholder="Search expenses..." class="bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md py-2 px-3 text-sm">
            </div>
          </div>
          
          <div class="overflow-x-auto">
            <table class="expense-table w-full">
              <thead class="border-b dark:border-gray-700">
                <tr>
                  <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider" data-sort="date">
                    Date <i class="fas fa-sort ml-1"></i>
                  </th>
                  <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider" data-sort="amount">
                    Amount <i class="fas fa-sort ml-1"></i>
                  </th>
                  <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider" data-sort="category">
                    Category <i class="fas fa-sort ml-1"></i>
                  </th>
                  <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider" data-sort="description">
                    Description <i class="fas fa-sort ml-1"></i>
                  </th>
                </tr>
              </thead>
              <tbody id="expenseTableBody">
                <!-- Expense rows will be loaded here -->
              </tbody>
            </table>
            <div id="tableEmptyState" class="empty-state py-8">
              <i class="fas fa-search text-4xl text-gray-300 dark:text-gray-600 mb-2"></i>
              <p class="text-gray-500 dark:text-gray-400">No expenses found</p>
              <button class="nav-link mt-3 px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition-colors" data-tab="add-expense">
                Add your first expense
              </button>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- Toast Notification -->
    <div id="toast" class="toast">
      <span id="toastMessage">Expense added successfully!</span>
    </div>
  </div>

  <script id="app-script">
    // Initialize app when DOM is loaded
    document.addEventListener('DOMContentLoaded', function() {
      // Dark mode toggle
      const darkModeToggle = document.getElementById('darkModeToggle');
      
      // Check for saved theme preference or prefer-color-scheme
      const savedTheme = localStorage.getItem('theme');
      if (savedTheme === 'dark' || (!savedTheme && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
        document.documentElement.classList.add('dark');
      }
      
      darkModeToggle.addEventListener('click', () => {
        document.documentElement.classList.toggle('dark');
        const isDark = document.documentElement.classList.contains('dark');
        localStorage.setItem('theme', isDark ? 'dark' : 'light');
      });
      
      // Tab navigation
      const navTabs = document.querySelectorAll('.nav-tab');
      const navLinks = document.querySelectorAll('.nav-link');
      const tabContents = document.querySelectorAll('.tab-content');
      
      function setActiveTab(tabId) {
        // Update nav tabs
        navTabs.forEach(tab => {
          if (tab.getAttribute('data-tab') === tabId) {
            tab.classList.add('active', 'border-blue-500', 'text-blue-500');
            tab.classList.remove('border-transparent', 'text-gray-500');
          } else {
            tab.classList.remove('active', 'border-blue-500', 'text-blue-500');
            tab.classList.add('border-transparent', 'text-gray-500');
          }
        });
        
        // Update content
        tabContents.forEach(content => {
          if (content.id === tabId) {
            content.classList.add('active');
          } else {
            content.classList.remove('active');
          }
        });
      }
      
      navTabs.forEach(tab => {
        tab.addEventListener('click', () => {
          const tabId = tab.getAttribute('data-tab');
          setActiveTab(tabId);
        });
      });
      
      navLinks.forEach(link => {
        link.addEventListener('click', () => {
          const tabId = link.getAttribute('data-tab');
          setActiveTab(tabId);
        });
      });
      
      // Form handling
      const expenseForm = document.getElementById('expenseForm');
      const addCategoryBtn = document.getElementById('addCategoryBtn');
      const customCategoryInput = document.getElementById('customCategoryInput');
      const saveCategoryBtn = document.getElementById('saveCategoryBtn');
      const categorySelect = document.getElementById('expenseCategory');
      
      // Add category button
      addCategoryBtn.addEventListener('click', () => {
        customCategoryInput.classList.toggle('hidden');
      });
      
      // Save new category
      saveCategoryBtn.addEventListener('click', () => {
        const newCategoryInput = document.getElementById('newCategory');
        const newCategory = newCategoryInput.value.trim();
        
        if (newCategory) {
          // Add to dropdowns
          const option = document.createElement('option');
          option.value = newCategory;
          option.textContent = newCategory;
          
          categorySelect.appendChild(option);
          categorySelect.value = newCategory;
          
          // Also add to other dropdowns
          const categoryFilters = document.querySelectorAll('select[id$="CategoryFilter"]');
          categoryFilters.forEach(filter => {
            const filterOption = document.createElement('option');
            filterOption.value = newCategory;
            filterOption.textContent = newCategory;
            filter.appendChild(filterOption);
          });
          
          // Hide custom input
          customCategoryInput.classList.add('hidden');
          newCategoryInput.value = '';
          
          // Store in local storage
          const savedCategories = JSON.parse(localStorage.getItem('expenseCategories') || '[]');
          if (!savedCategories.includes(newCategory)) {
            savedCategories.push(newCategory);
            localStorage.setItem('expenseCategories', JSON.stringify(savedCategories));
          }
        }
      });
      
      // Form submission
      expenseForm.addEventListener('submit', (e) => {
        e.preventDefault();
        
        // Validate form
        const date = document.getElementById('expenseDate').value;
        const amount = parseFloat(document.getElementById('expenseAmount').value);
        const category = document.getElementById('expenseCategory').value;
        const description = document.getElementById('expenseDescription').value.trim();
        
        if (!date || isNaN(amount) || amount <= 0 || !category) {
          // Show error message
          showToast('Please fill all required fields', 'error');
          return;
        }
        
        // Create expense object
        const expense = {
          id: Date.now().toString(),
          date,
          amount,
          category,
          description,
          timestamp: new Date().toISOString()
        };
        
        // Save to localStorage
        const expenses = JSON.parse(localStorage.getItem('expenses') || '[]');
        expenses.push(expense);
        localStorage.setItem('expenses', JSON.stringify(expenses));
        
        // Reset form
        expenseForm.reset();
        
        // Show success message
        showToast('Expense added successfully!', 'success');
        
        // Update UI
        updateExpenseSummaries();
        updateExpenseTable();
        updateCharts();
      });
      
      // Toast notification
      function showToast(message, type = 'success') {
        const toast = document.getElementById('toast');
        const toastMessage = document.getElementById('toastMessage');
        
        // Set message and style
        toastMessage.textContent = message;
        
        if (type === 'error') {
          toast.style.backgroundColor = '#EF4444'; // Red
        } else {
          toast.style.backgroundColor = '#10B981'; // Green
        }
        
        // Show toast
        toast.classList.add('show');
        
        // Hide after 3 seconds
        setTimeout(() => {
          toast.classList.remove('show');
        }, 3000);
      }
      
      // Initialize expense summaries
      function updateExpenseSummaries() {
        const expenses = JSON.parse(localStorage.getItem('expenses') || '[]');
        
        // Set date ranges
        const today = new Date();
        const startOfWeek = new Date(today);
        startOfWeek.setDate(today.getDate() - today.getDay());
        const endOfWeek = new Date(today);
        endOfWeek.setDate(startOfWeek.getDate() + 6);
        
        const startOfMonth = new Date(today.getFullYear(), today.getMonth(), 1);
        const endOfMonth = new Date(today.getFullYear(), today.getMonth() + 1, 0);
        
        // Format dates for display
        const weeklyDatesEl = document.getElementById('weeklyDates');
        const monthlyDatesEl = document.getElementById('monthlyDates');
        
        weeklyDatesEl.textContent = `${formatDate(startOfWeek)} - ${formatDate(endOfWeek)}`;
        monthlyDatesEl.textContent = `${new Intl.DateTimeFormat('en-US', { month: 'long' }).format(startOfMonth)} ${startOfMonth.getFullYear()}`;
        
        // Filter expenses for this week and month
        const weeklyExpenses = expenses.filter(exp => {
          const expDate = new Date(exp.date);
          return expDate >= startOfWeek && expDate <= endOfWeek;
        });
        
        const monthlyExpenses = expenses.filter(exp => {
          const expDate = new Date(exp.date);
          return expDate >= startOfMonth && expDate <= endOfMonth;
        });
        
        // Calculate totals
        const weeklyTotal = weeklyExpenses.reduce((sum, exp) => sum + exp.amount, 0);
        const monthlyTotal = monthlyExpenses.reduce((sum, exp) => sum + exp.amount, 0);
        
        // Update UI
        document.getElementById('weeklyTotal').textContent = formatCurrency(weeklyTotal);
        document.getElementById('monthlyTotal').textContent = formatCurrency(monthlyTotal);
        
        // Update recent transactions
        updateRecentTransactions(expenses.slice(0, 5));
        
        // Update trend charts
        updateTrendCharts(expenses);
      }
      
      // Format date helper
      function formatDate(date) {
        return new Intl.DateTimeFormat('en-US', { 
          month: 'short',
          day: 'numeric' 
        }).format(date);
      }
      
      // Format currency helper
      function formatCurrency(amount) {
        return new Intl.NumberFormat('en-US', {
          style: 'currency',
          currency: 'USD',
          minimumFractionDigits: 2
        }).format(amount);
      }
      
      // Update recent transactions
      function updateRecentTransactions(recentExpenses) {
        const container = document.getElementById('recentTransactions');
        
        if (recentExpenses.length === 0) {
          container.innerHTML = `
            <div class="empty-state py-8">
              <i class="fas fa-receipt text-4xl text-gray-300 dark:text-gray-600 mb-2"></i>
              <p class="text-gray-500 dark:text-gray-400">No recent transactions to display</p>
              <button class="nav-link mt-3 px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition-colors" data-tab="add-expense">
                Add your first expense
              </button>
            </div>
          `;
          return;
        }
        
        const transactionsList = document.createElement('div');
        transactionsList.className = 'divide-y dark:divide-gray-700';
        
        recentExpenses.forEach(expense => {
          const date = new Date(expense.date);
          const formattedDate = formatDate(date);
          
          const item = document.createElement('div');
          item.className = 'py-3 flex justify-between items-center';
          
          item.innerHTML = `
            <div class="flex items-center">
              <div class="rounded-full bg-blue-100 dark:bg-blue-900 w-10 h-10 flex items-center justify-center mr-3">
                <i class="fas fa-${getCategoryIcon(expense.category)} text-blue-500"></i>
              </div>
              <div>
                <p class="font-medium text-gray-800 dark:text-gray-200">${expense.category}</p>
                <p class="text-sm text-gray-500 dark:text-gray-400">${expense.description || 'No description'}</p>
              </div>
            </div>
            <div class="text-right">
              <p class="font-medium text-gray-800 dark:text-gray-200">${formatCurrency(expense.amount)}</p>
              <p class="text-xs text-gray-500 dark:text-gray-400">${formattedDate}</p>
            </div>
          `;
          
          transactionsList.appendChild(item);
        });
        
        container.innerHTML = '';
        container.appendChild(transactionsList);
        
        // Add event listeners for nav links
        const navLinks = container.querySelectorAll('.nav-link');
        navLinks.forEach(link => {
          link.addEventListener('click', () => {
            const tabId = link.getAttribute('data-tab');
            setActiveTab(tabId);
          });
        });
      }
      
      // Get icon for category
      function getCategoryIcon(category) {
        const icons = {
          'Food': 'utensils',
          'Travel': 'plane',
          'Utilities': 'bolt',
          'Entertainment': 'film',
          'Health': 'heartbeat',
          'Others': 'tag'
        };
        
        return icons[category] || 'tag';
      }
      
      // Update trend charts
      function updateTrendCharts(expenses) {
        // Weekly trend chart
        const weeklyCtx = document.getElementById('weeklyTrendChart').getContext('2d');
        const weeklyData = getLast7DaysData(expenses);
        
        if (window.weeklyChart) {
          window.weeklyChart.destroy();
        }
        
        window.weeklyChart = new Chart(weeklyCtx, {
          type: 'line',
          data: {
            labels: weeklyData.labels,
            datasets: [{
              data: weeklyData.data,
              borderColor: '#3b82f6',
              backgroundColor: 'rgba(59, 130, 246, 0.1)',
              fill: true,
              tension: 0.4,
              pointRadius: 0
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                display: false
              },
              tooltip: {
                enabled: false
              }
            },
            scales: {
              x: {
                display: false
              },
              y: {
                display: false
              }
            }
          }
        });
        
        // Monthly trend chart
        const monthlyCtx = document.getElementById('monthlyTrendChart').getContext('2d');
        const monthlyData = getLast30DaysData(expenses);
        
        if (window.monthlyChart) {
          window.monthlyChart.destroy();
        }
        
        window.monthlyChart = new Chart(monthlyCtx, {
          type: 'line',
          data: {
            labels: monthlyData.labels,
            datasets: [{
              data: monthlyData.data,
              borderColor: '#3b82f6',
              backgroundColor: 'rgba(59, 130, 246, 0.1)',
              fill: true,
              tension: 0.4,
              pointRadius: 0
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                display: false
              },
              tooltip: {
                enabled: false
              }
            },
            scales: {
              x: {
                display: false
              },
              y: {
                display: false
              }
            }
          }
        });
      }
      
      // Get last 7 days data
      function getLast7DaysData(expenses) {
        const labels = [];
        const data = [];
        
        // Generate last 7 days
        const today = new Date();
        
        for (let i = 6; i >= 0; i--) {
          const date = new Date();
          date.setDate(today.getDate() - i);
          
          const dateString = date.toISOString().split('T')[0];
          
          // Sum expenses for this day
          const dayTotal = expenses
            .filter(exp => exp.date === dateString)
            .reduce((sum, exp) => sum + exp.amount, 0);
          
          labels.push(formatDate(date));
          data.push(dayTotal);
        }
        
        return { labels, data };
      }
      
      // Get last 30 days data
      function getLast30DaysData(expenses) {
        const labels = [];
        const data = [];
        
        // Generate last 30 days
        const today = new Date();
        
        for (let i = 29; i >= 0; i--) {
          const date = new Date();
          date.setDate(today.getDate() - i);
          
          const dateString = date.toISOString().split('T')[0];
          
          // Sum expenses for this day
          const dayTotal = expenses
            .filter(exp => exp.date === dateString)
            .reduce((sum, exp) => sum + exp.amount, 0);
          
          labels.push(formatDate(date));
          data.push(dayTotal);
        }
        
        return { labels, data };
      }
      
      // Update expense table
      function updateExpenseTable() {
        const expenses = JSON.parse(localStorage.getItem('expenses') || '[]');
        const tableBody = document.getElementById('expenseTableBody');
        const emptyState = document.getElementById('tableEmptyState');
        
        if (expenses.length === 0) {
          tableBody.innerHTML = '';
          emptyState.classList.remove('hidden');
          return;
        }
        
        emptyState.classList.add('hidden');
        tableBody.innerHTML = '';
        
        // Sort by date (newest first)
        const sortedExpenses = [...expenses].sort((a, b) => new Date(b.date) - new Date(a.date));
        
        sortedExpenses.forEach(expense => {
          const row = document.createElement('tr');
          row.className = 'table-row border-b dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800';
          
          const formattedDate = formatDate(new Date(expense.date));
          
          row.innerHTML = `
            <td class="px-4 py-4 text-sm text-gray-800 dark:text-gray-200">${formattedDate}</td>
            <td class="px-4 py-4 text-sm font-medium text-gray-800 dark:text-gray-200">${formatCurrency(expense.amount)}</td>
            <td class="px-4 py-4 text-sm text-gray-800 dark:text-gray-200">${expense.category}</td>
            <td class="px-4 py-4 text-sm text-gray-800 dark:text-gray-200">${expense.description || '-'}</td>
          `;
          
          tableBody.appendChild(row);
        });
      }
      
      // Update charts in reports tab
      function updateCharts() {
        const expenses = JSON.parse(localStorage.getItem('expenses') || '[]');
        
        // Skip if no expenses
        if (expenses.length === 0) {
          return;
        }
        
        // Category pie chart
        updateCategoryPieChart(expenses);
        
        // Time series chart (default to weekly)
        updateTimeSeriesChart(expenses, 'weekly');
        
        // Set up time series view toggle
        document.getElementById('viewWeekly').addEventListener('click', function() {
          this.classList.add('bg-blue-500', 'text-white');
          this.classList.remove('bg-gray-200', 'dark:bg-gray-700', 'text-gray-700', 'dark:text-gray-300');
          
          const monthlyBtn = document.getElementById('viewMonthly');
          monthlyBtn.classList.remove('bg-blue-500', 'text-white');
          monthlyBtn.classList.add('bg-gray-200', 'dark:bg-gray-700', 'text-gray-700', 'dark:text-gray-300');
          
          updateTimeSeriesChart(expenses, 'weekly');
        });
        
        document.getElementById('viewMonthly').addEventListener('click', function() {
          this.classList.add('bg-blue-500', 'text-white');
          this.classList.remove('bg-gray-200', 'dark:bg-gray-700', 'text-gray-700', 'dark:text-gray-300');
          
          const weeklyBtn = document.getElementById('viewWeekly');
          weeklyBtn.classList.remove('bg-blue-500', 'text-white');
          weeklyBtn.classList.add('bg-gray-200', 'dark:bg-gray-700', 'text-gray-700', 'dark:text-gray-300');
          
          updateTimeSeriesChart(expenses, 'monthly');
        });
      }
      
      // Update category pie chart
      function updateCategoryPieChart(expenses) {
        const ctx = document.getElementById('categoryPieChart').getContext('2d');
        
        // Get spending by category
        const categoryTotals = expenses.reduce((acc, expense) => {
          if (!acc[expense.category]) {
            acc[expense.category] = 0;
          }
          acc[expense.category] += expense.amount;
          return acc;
        }, {});
        
        const categories = Object.keys(categoryTotals);
        const amounts = Object.values(categoryTotals);
        
        // Generate colors
        const colors = [
          '#3B82F6', // Blue
          '#EF4444', // Red
          '#10B981', // Green
          '#F59E0B', // Yellow
          '#8B5CF6', // Purple
          '#EC4899', // Pink
          '#6366F1'  // Indigo
        ];
        
        // Fill in more colors if needed
        while (colors.length < categories.length) {
          colors.push('#' + Math.floor(Math.random()*16777215).toString(16));
        }
        
        if (window.categoryChart) {
          window.categoryChart.destroy();
        }
        
        window.categoryChart = new Chart(ctx, {
          type: 'doughnut',
          data: {
            labels: categories,
            datasets: [{
              data: amounts,
              backgroundColor: colors,
              borderColor: document.documentElement.classList.contains('dark') ? '#1F2937' : '#FFFFFF',
              borderWidth: 2
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                position: 'right',
                labels: {
                  color: document.documentElement.classList.contains('dark') ? '#F3F4F6' : '#1F2937',
                  font: {
                    family: 'Inter'
                  }
                }
              },
              tooltip: {
                callbacks: {
                  label: function(context) {
                    const value = context.raw;
                    return `${context.label}: ${formatCurrency(value)}`;
                  }
                }
              }
            }
          }
        });
      }
      
      // Update time series chart
      function updateTimeSeriesChart(expenses, viewType) {
        const ctx = document.getElementById('timeSeriesChart').getContext('2d');
        let chartData;
        
        if (viewType === 'weekly') {
          chartData = getWeeklyChartData(expenses);
        } else {
          chartData = getMonthlyChartData(expenses);
        }
        
        if (window.timeSeriesChart) {
          window.timeSeriesChart.destroy();
        }
        
        window.timeSeriesChart = new Chart(ctx, {
          type: 'bar',
          data: {
            labels: chartData.labels,
            datasets: [{
              label: 'Spending',
              data: chartData.data,
              backgroundColor: 'rgba(59, 130, 246, 0.7)',
              borderColor: '#3b82f6',
              borderWidth: 1
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                display: false
              },
              tooltip: {
                callbacks: {
                  label: function(context) {
                    const value = context.raw;
                    return `${formatCurrency(value)}`;
                  }
                }
              }
            },
            scales: {
              y: {
                beginAtZero: true,
                ticks: {
                  callback: function(value) {
                    return '$' + value;
                  },
                  color: document.documentElement.classList.contains('dark') ? '#D1D5DB' : '#6B7280'
                },
                grid: {
                  color: document.documentElement.classList.contains('dark') ? 'rgba(255, 255, 255, 0.05)' : 'rgba(0, 0, 0, 0.05)'
                }
              },
              x: {
                ticks: {
                  color: document.documentElement.classList.contains('dark') ? '#D1D5DB' : '#6B7280'
                },
                grid: {
                  display: false
                }
              }
            }
          }
        });
      }
      
      // Get weekly chart data
      function getWeeklyChartData(expenses) {
        const labels = [];
        const data = [];
        
        // Get last 12 weeks
        const today = new Date();
        const oneWeek = 7 * 24 * 60 * 60 * 1000; // One week in milliseconds
        
        for (let i = 11; i >= 0; i--) {
          const weekEnd = new Date(today.getTime() - (i * oneWeek));
          const weekStart = new Date(weekEnd.getTime() - oneWeek);
          
          // Format week label
          const weekLabel = `${formatDate(weekStart)} - ${formatDate(weekEnd)}`;
          
          // Sum expenses for this week
          const weekExpenses = expenses.filter(exp => {
            const expDate = new Date(exp.date);
            return expDate >= weekStart && expDate <= weekEnd;
          });
          
          const weekTotal = weekExpenses.reduce((sum, exp) => sum + exp.amount, 0);
          
          labels.push(weekLabel);
          data.push(weekTotal);
        }
        
        return { labels, data };
      }
      
      // Get monthly chart data
      function getMonthlyChartData(expenses) {
        const labels = [];
        const data = [];
        
        // Get last 12 months
        const today = new Date();
        
        for (let i = 11; i >= 0; i--) {
          const month = new Date(today.getFullYear(), today.getMonth() - i, 1);
          const monthEnd = new Date(month.getFullYear(), month.getMonth() + 1, 0);
          
          // Format month label
          const monthLabel = new Intl.DateTimeFormat('en-US', { month: 'short', year: '2-digit' }).format(month);
          
          // Sum expenses for this month
          const monthExpenses = expenses.filter(exp => {
            const expDate = new Date(exp.date);
            return expDate.getMonth() === month.getMonth() && expDate.getFullYear() === month.getFullYear();
          });
          
          const monthTotal = monthExpenses.reduce((sum, exp) => sum + exp.amount, 0);
          
          labels.push(monthLabel);
          data.push(monthTotal);
        }
        
        return { labels, data };
      }
      
      // Export table data to CSV
      document.getElementById('exportCSV').addEventListener('click', function() {
        const expenses = JSON.parse(localStorage.getItem('expenses') || '[]');
        
        if (expenses.length === 0) {
          showToast('No data to export', 'error');
          return;
        }
        
        // Create CSV content
        let csvContent = 'Date,Amount,Category,Description\n';
        
        expenses.forEach(expense => {
          const row = [
            expense.date,
            expense.amount,
            expense.category,
            `"${expense.description || ''}"`
          ];
          
          csvContent += row.join(',') + '\n';
        });
        
        // Create download link
        const encodedUri = encodeURI('data:text/csv;charset=utf-8,' + csvContent);
        const link = document.createElement('a');
        link.setAttribute('href', encodedUri);
        link.setAttribute('download', 'expense_data.csv');
        document.body.appendChild(link);
        
        // Trigger download
        link.click();
        document.body.removeChild(link);
        
        showToast('CSV file exported successfully');
      });
      
      // Search functionality
      document.getElementById('searchExpenses').addEventListener('input', function() {
        const searchTerm = this.value.toLowerCase();
        const expenses = JSON.parse(localStorage.getItem('expenses') || '[]');
        
        if (searchTerm === '') {
          updateExpenseTable();
          return;
        }
        
        const filteredExpenses = expenses.filter(expense => {
          return (
            expense.category.toLowerCase().includes(searchTerm) ||
            (expense.description && expense.description.toLowerCase().includes(searchTerm)) ||
            expense.date.includes(searchTerm) ||
            expense.amount.toString().includes(searchTerm)
          );
        });
        
        // Update table with filtered data
        const tableBody = document.getElementById('expenseTableBody');
        const emptyState = document.getElementById('tableEmptyState');
        
        if (filteredExpenses.length === 0) {
          tableBody.innerHTML = '';
          emptyState.classList.remove('hidden');
          return;
        }
        
        emptyState.classList.add('hidden');
        tableBody.innerHTML = '';
        
        filteredExpenses.forEach(expense => {
          const row = document.createElement('tr');
          row.className = 'table-row border-b dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800';
          
          const formattedDate = formatDate(new Date(expense.date));
          
          row.innerHTML = `
            <td class="px-4 py-4 text-sm text-gray-800 dark:text-gray-200">${formattedDate}</td>
            <td class="px-4 py-4 text-sm font-medium text-gray-800 dark:text-gray-200">${formatCurrency(expense.amount)}</td>
            <td class="px-4 py-4 text-sm text-gray-800 dark:text-gray-200">${expense.category}</td>
            <td class="px-4 py-4 text-sm text-gray-800 dark:text-gray-200">${expense.description || '-'}</td>
          `;
          
          tableBody.appendChild(row);
        });
      });
      
      // Table sorting
      document.querySelectorAll('.expense-table th[data-sort]').forEach(header => {
        header.addEventListener('click', function() {
          const sortField = this.getAttribute('data-sort');
          const expenses = JSON.parse(localStorage.getItem('expenses') || '[]');
          
          // Toggle sort direction
          const currentDirection = this.getAttribute('data-direction') || 'asc';
          const newDirection = currentDirection === 'asc' ? 'desc' : 'asc';
          
          // Update direction attribute
          document.querySelectorAll('.expense-table th[data-sort]').forEach(th => {
            th.removeAttribute('data-direction');
            th.querySelector('i').className = 'fas fa-sort ml-1';
          });
          
          this.setAttribute('data-direction', newDirection);
          this.querySelector('i').className = `fas fa-sort-${newDirection === 'asc' ? 'up' : 'down'} ml-1`;
          
          // Sort expenses
          const sortedExpenses = [...expenses].sort((a, b) => {
            let compareA = a[sortField];
            let compareB = b[sortField];
            
            // Special handling for date
            if (sortField === 'date') {
              compareA = new Date(compareA);
              compareB = new Date(compareB);
            }
            
            if (compareA < compareB) {
              return newDirection === 'asc' ? -1 : 1;
            }
            if (compareA > compareB) {
              return newDirection === 'asc' ? 1 : -1;
            }
            return 0;
          });
          
          // Update table
          const tableBody = document.getElementById('expenseTableBody');
          tableBody.innerHTML = '';
          
          sortedExpenses.forEach(expense => {
            const row = document.createElement('tr');
            row.className = 'table-row border-b dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800';
            
            const formattedDate = formatDate(new Date(expense.date));
            
            row.innerHTML = `
              <td class="px-4 py-4 text-sm text-gray-800 dark:text-gray-200">${formattedDate}</td>
              <td class="px-4 py-4 text-sm font-medium text-gray-800 dark:text-gray-200">${formatCurrency(expense.amount)}</td>
              <td class="px-4 py-4 text-sm text-gray-800 dark:text-gray-200">${expense.category}</td>
              <td class="px-4 py-4 text-sm text-gray-800 dark:text-gray-200">${expense.description || '-'}</td>
            `;
            
            tableBody.appendChild(row);
          });
        });
      });
      
      // Initialize app
      function initializeApp() {
        // Set today's date as default for expense form
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('expenseDate').value = today;
        
        // Set date filters default values
        const firstDayOfMonth = new Date(new Date().getFullYear(), new Date().getMonth(), 1).toISOString().split('T')[0];
        const lastDayOfMonth = new Date(new Date().getFullYear(), new Date().getMonth() + 1, 0).toISOString().split('T')[0];
        
        document.getElementById('startDate').value = firstDayOfMonth;
        document.getElementById('endDate').value = lastDayOfMonth;
        document.getElementById('reportStartDate').value = firstDayOfMonth;
        document.getElementById('reportEndDate').value = lastDayOfMonth;
        
        // Load saved categories if any
        const savedCategories = JSON.parse(localStorage.getItem('expenseCategories') || '[]');
        if (savedCategories.length > 0) {
          const categorySelects = [
            document.getElementById('expenseCategory'),
            document.getElementById('categoryFilter'),
            document.getElementById('reportCategoryFilter')
          ];
          
          savedCategories.forEach(category => {
            categorySelects.forEach(select => {
              // Check if option already exists
              if (!Array.from(select.options).some(option => option.value === category)) {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                select.appendChild(option);
              }
            });
          });
        }
        
        // Update UI components
        updateExpenseSummaries();
        updateExpenseTable();
        updateCharts();
      }
      
      // Call initialize
      initializeApp();
    });
  </script>
</body>
</html>